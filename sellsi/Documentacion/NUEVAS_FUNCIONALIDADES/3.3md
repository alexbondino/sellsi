# ğŸ” ANÃLISIS PROFUNDO - PRIORIDAD MEDIA 3.3: Hooks Especializados y Stores Zustand

## ğŸ“Š RESUMEN EJECUTIVO

**Fecha de anÃ¡lisis**: 22 de julio de 2025  
**Rollback previo**: 15 horas de trabajo perdidas  
**Estado encontrado**: PARCIALMENTE EXAGERADO con problemas reales identificados  

## ğŸš¨ **ANÃLISIS CRÃTICO: ARCHIVOS RESIDUALES DEL ROLLBACK - ESTADO MIXTO**

**DESCUBRIMIENTO CRÃTICO**: Se han encontrado archivos en `/src/domains/` del rollback anterior. **NO SON RESIDUOS CORRUPTOS**, sino el **OBJETIVO FINAL** del plan 3.3, pero estÃ¡n en estado **MIXTO** (algunos completos, otros incompletos):

```bash
ğŸ” ARCHIVOS DOMAINS ANALIZADOS:
â”œâ”€â”€ domains/admin/                          # 4,285 LOC - ESTADO: âœ… COMPLETOS Y FUNCIONALES
â”‚   â”œâ”€â”€ services/                           # 9 servicios migrados correctamente
â”‚   â”‚   â”œâ”€â”€ adminAccountService.js          # 247 LOC âœ… MIGRADO CORRECTAMENTE
â”‚   â”‚   â”œâ”€â”€ adminApiService.js              # 234 LOC âœ… MIGRADO CORRECTAMENTE  
â”‚   â”‚   â”œâ”€â”€ adminAuditService.js            # 651 LOC âœ… MIGRADO CORRECTAMENTE
â”‚   â”‚   â”œâ”€â”€ adminAuthService.js             # 405 LOC âœ… COMPLETO CON 2FA
â”‚   â”‚   â”œâ”€â”€ adminFileService.js             # 570 LOC âœ… MIGRADO CORRECTAMENTE
â”‚   â”‚   â”œâ”€â”€ adminProductService.js          # 610 LOC âœ… MIGRADO CORRECTAMENTE
â”‚   â”‚   â”œâ”€â”€ adminRequestService.js          # 612 LOC âœ… MIGRADO CORRECTAMENTE
â”‚   â”‚   â”œâ”€â”€ adminUserService.js             # 532 LOC âœ… MIGRADO CORRECTAMENTE
â”‚   â”‚   â””â”€â”€ index.js                        # 171 LOC âœ… BARREL EXPORTS CORRECTO
â”‚   â”œâ”€â”€ CLEANUP_COMPLETED.md                # 82 LOC âœ… DocumentaciÃ³n de migraciÃ³n exitosa
â”‚   â””â”€â”€ README.md                           # 137 LOC âœ… DocumentaciÃ³n actualizada
â”œâ”€â”€ domains/supplier/hooks/                 # 615 LOC - ESTADO: âš ï¸ MEJORADOS PERO NO CONECTADOS
â”‚   â”œâ”€â”€ dashboard-management/
â”‚   â”‚   â”œâ”€â”€ useSupplierDashboard.js         # 266 LOC âœ… VERSION MEJORADA (+138 LOC vs features)
â”‚   â”‚   â””â”€â”€ useSupplierDashboard_functional.js # 137 LOC âš ï¸ VersiÃ³n alternativa
â”‚   â””â”€â”€ product-management/
â”‚       â””â”€â”€ index.js                        # 183 LOC âš ï¸ Hook composite sin uso
â””â”€â”€ domains/index.js                        # 45 LOC âœ… BARREL EXPORTS CORRECTO

ğŸ“Š TOTAL DOMAINS: 4,945 LOC - REFACTOR AVANZADO NO CONECTADO
```

**HALLAZGOS REALES**:
- âœ… **Servicios Admin**: CORRECTAMENTE MIGRADOS y documentados como completados
- âœ… **useSupplierDashboard en domains**: VERSION MEJORADA (+138 LOC) con mÃ¡s funcionalidades  
- âŒ **Hook no conectado**: La versiÃ³n mejorada NO estÃ¡ siendo usada (features usa la versiÃ³n corta)
- âš ï¸ **Estado inconsistente**: Refactor completado pero NO activado

### ğŸ” **COMPARACIÃ“N DE VERSIONES useSupplierDashboard**:
```bash
ğŸ“Š COMPARACIÃ“N TÃ‰CNICA:
â”œâ”€â”€ features/supplier/home/hooks/useSupplierDashboard.js  # 128 LOC âš ï¸ EN USO ACTUAL
â”‚   â”œâ”€â”€ âŒ Sin mÃ©todos de compatibilidad (applyFilters, getProductById)
â”‚   â”œâ”€â”€ âŒ Sin estados de operaciones (deleting, updating)  
â”‚   â”œâ”€â”€ âŒ Sin gestiÃ³n de tramos de precio
â”‚   â””â”€â”€ âŒ Sin mÃ©todo loadProducts para recarga manual
â”œâ”€â”€ domains/supplier/hooks/dashboard-management/useSupplierDashboard.js # 266 LOC âœ… VERSION MEJORADA
â”‚   â”œâ”€â”€ âœ… API de compatibilidad completa para migraciÃ³n  
â”‚   â”œâ”€â”€ âœ… Estados de operaciones para UI (deleting, updating)
â”‚   â”œâ”€â”€ âœ… GestiÃ³n avanzada de price_tiers con fallbacks
â”‚   â”œâ”€â”€ âœ… MÃ©todo loadProducts pÃºblico para recargas
â”‚   â””â”€â”€ âœ… Sistema de filtros integrado (searchTerm, categoryFilter)

ğŸ¯ CONCLUSIÃ“N: La versiÃ³n domains/ estÃ¡ MÃS COMPLETA que features/
```

## âš ï¸ **ANÃLISIS CRÃTICO DE ERRORES - MOTIVO DEL ROLLBACK**

**ALERTA IMPORTANTE**: Aunque la versiÃ³n domains/ es mÃ¡s completa, **FUE LA CAUSA DEL ROLLBACK DE 15 HORAS** por errores al activarse. Se requiere **ANÃLISIS PROFUNDO** antes de reactivar.

### ğŸ” **COMPARACIÃ“N DETALLADA: DIFERENCIAS CRÃTICAS**

#### **useSupplierDashboard - ANÃLISIS LÃNEA POR LÃNEA**

```bash
ğŸ“Š DIFERENCIAS FUNCIONALES DETECTADAS:

1. GESTIÃ“N DE PRICE_TIERS:
   â”œâ”€â”€ features/ (128 LOC) âŒ SIMPLE - Sin tramos de precio
   â””â”€â”€ domains/ (266 LOC) âš ï¸ COMPLEJO - Doble query (product_quantity_ranges + price_tiers)

2. ESTRUCTURA DE DATOS:
   â”œâ”€â”€ features/ âœ… ESTABLE - Solo products, sales, weeklyRequests  
   â””â”€â”€ domains/ âš ï¸ COMPLEJO - +filteredProducts, +deleting, +updating states

3. MÃ‰TODOS PÃšBLICOS:
   â”œâ”€â”€ features/ âœ… SIMPLE - Solo retorna datos
   â””â”€â”€ domains/ âš ï¸ MÃšLTIPLES - loadProducts(), applyFilters(), getProductById()

4. MANEJO DE ERRORES:
   â”œâ”€â”€ features/ âœ… BÃSICO - try/catch simple
   â””â”€â”€ domains/ âš ï¸ AVANZADO - Fallbacks para tablas inexistentes
```

#### **POTENCIALES CAUSAS DEL ROLLBACK IDENTIFICADAS:**

```bash
ğŸš¨ ERRORES PROBABLES QUE CAUSARON EL ROLLBACK:

1. QUERIES INCOMPATIBLES:
   âŒ domains/ usa 'product_quantity_ranges' + 'price_tiers'
   âœ… features/ no usa tramos de precio
   â†’ POSIBLE ERROR: Tabla price_tiers no existe o cambiÃ³ estructura

2. DEPENDENCIAS ROTAS:
   âŒ domains/ mÃ©todo loadProducts() puede ser llamado por componentes
   âœ… features/ no expone mÃ©todos pÃºblicos
   â†’ POSIBLE ERROR: Componentes esperan mÃ©todos que no existen

3. ESTADOS INCOMPATIBLES:
   âŒ domains/ +deleting, +updating, +filteredProducts
   âœ… features/ estructura simple
   â†’ POSIBLE ERROR: Componentes no manejan estados adicionales

4. IMPORTS ROTOS:
   âŒ domains/ usa imports relativos diferentes
   âœ… features/ imports establecidos
   â†’ POSIBLE ERROR: Rutas de import incorrectas al activar
```

### ğŸ”¬ **PUNTOS DE VERIFICACIÃ“N OBLIGATORIOS**

**ANTES DE REACTIVAR domains/useSupplierDashboard.js:**

#### 1. **VERIFICAR ESQUEMA DE BASE DE DATOS** âŒ CRÃTICO
```sql
-- Verificar que estas tablas existen y tienen la estructura esperada:
SELECT * FROM product_quantity_ranges LIMIT 1;  -- Â¿Existe?
SELECT * FROM price_tiers LIMIT 1;              -- Â¿Existe?

-- Verificar columnas especÃ­ficas que usa domains/:
-- product_quantity_ranges: product_id, min_qty (?)
-- price_tiers: product_id, min_qty (?)
```

#### 2. **VERIFICAR COMPATIBILIDAD DE API** âŒ CRÃTICO  
```javascript
// Â¿Los componentes esperan estos mÃ©todos que domains/ aÃ±ade?
const { loadProducts, applyFilters, getProductById } = useSupplierDashboard()

// Â¿Los componentes manejan estos estados adicionales?
const { deleting, updating, filteredProducts } = useSupplierDashboard()
```

#### 3. **VERIFICAR IMPORTS Y PATHS** âŒ CRÃTICO
```javascript
// Â¿Este path es correcto desde ProviderHome.jsx?
import { useSupplierDashboard } from '../../../domains/supplier/hooks/dashboard-management/useSupplierDashboard'

// Â¿Los imports internos de domains/ funcionan?
import { supabase } from '../../../../services/supabase'  // Â¿Path correcto?
```

#### 4. **VERIFICAR ESTRUCTURA DE RETORNO** âŒ CRÃTICO
```javascript
// domains/ retorna MÃS datos que features/:
return {
  // âœ… Compatibles (ambas versiones):
  products, sales, productStocks, weeklyRequests, loading, error,
  
  // âŒ NUEVOS en domains/ (pueden romper componentes):
  filteredProducts, searchTerm, categoryFilter, sortBy, sortOrder,
  deleting, updating, applyFilters, loadProducts
}
```

### ğŸ“‹ **PROTOCOLO DE REACTIVACIÃ“N SEGURA**

**FASES OBLIGATORIAS ANTES DE ACTIVAR:**

#### FASE A: AUDITORÃA TÃ‰CNICA (2-3 horas)
```bash
1. âœ… Verificar esquema DB: product_quantity_ranges, price_tiers
2. âœ… Comparar imports paths entre versions  
3. âœ… Verificar que supabase queries funcionan
4. âœ… Probar domains/useSupplierDashboard en entorno de prueba
```

#### FASE B: PRUEBA CONTROLADA (1-2 horas)  
```bash
1. âœ… Activar SOLO en desarrollo local
2. âœ… Probar dashboard completo (mÃ©tricas, productos, filtros)
3. âœ… Verificar que no hay console.errors
4. âœ… Probar operaciones CRUD de productos
```

#### FASE C: ACTIVACIÃ“N GRADUAL (30 minutos)
```bash
1. âœ… Backup de ProviderHome.jsx actual
2. âœ… Cambiar import con rollback preparado
3. âœ… Monitorear errores en tiempo real
4. âœ… Rollback inmediato si hay errores
```

**RECOMENDACIÃ“N ACTUALIZADA**: 
1. **NO ACTIVAR** sin completar auditorÃ­a tÃ©cnica completa
2. **INVESTIGAR** exactamente quÃ© errores causaron el rollback original
3. **DOCUMENTAR** todas las diferencias tÃ©cnicas encontradas

---

### 2.1 Nueva Estructura Propuesta

```
src/
â”œâ”€â”€ domains/                    # ğŸ¯ Dominios de negocio (antes features)
â”‚   â”œâ”€â”€ admin/
â”‚   â”‚   â”œâ”€â”€ hooks/              # LÃ³gica especÃ­fica del dominio (useAdminAuth, useUserBans)
â”‚   â”‚   â”œâ”€â”€ stores/             # Zustand stores especÃ­ficos (adminStore.js)
â”‚   â”‚   â”œâ”€â”€ types/              # TypeScript interfaces especÃ­ficas del dominio
â”‚   â”‚   â”œâ”€â”€ utils/              # Funciones especÃ­ficas (adminValidators, adminFormatters)
â”‚   â”‚   â””â”€â”€ index.ts            # Barrel export
â”‚   â”œâ”€â”€ marketplace/
â”‚   â”œâ”€â”€ buyer/
â”‚   â”œâ”€â”€ supplier/
â”‚   â””â”€â”€ ...
â”œâ”€â”€ shared/                     # ğŸ”— CÃ³digo compartido entre dominios
â”‚   â”œâ”€â”€ components/             # TODOS los componentes UI (100% reutilizables)
â”‚   â”‚   â”œâ”€â”€ forms/              # QuantitySelector, InputField, FormWizard
â”‚   â”‚   â”œâ”€â”€ display/            # ProductCard, UserCard, StatusBadge
â”‚   â”‚   â”œâ”€â”€ feedback/           # LoadingSpinner, ErrorMessage, Toast
â”‚   â”‚   â”œâ”€â”€ navigation/         # Sidebar, Topbar, Breadcrumbs
â”‚   â”‚   â””â”€â”€ layout/             # Grid, Container, Spacing
â”‚   â”œâ”€â”€ hooks/                  # Hooks genÃ©ricos (useLazyImage, usePrefetch)
â”‚   â”œâ”€â”€ services/               # Servicios que interactÃºan con Supabase
â”‚   â”‚   â”œâ”€â”€ supabase/           # ConfiguraciÃ³n cliente Supabase
â”‚   â”‚   â”œâ”€â”€ upload/             # Upload a Supabase Storage
â”‚   â”‚   â””â”€â”€ auth/               # Wrapper de Supabase Auth
â”‚   â”œâ”€â”€ utils/                  # Funciones puras (formatters, validators, helpers)
â”‚   â”œâ”€â”€ types/                  # Types globales y Context interfaces
â”‚   â”œâ”€â”€ context/                # React Context providers (UserContext, ThemeContext)
â”‚   â””â”€â”€ constants/              # URLs, configuraciones, enums globales
â”œâ”€â”€ infrastructure/             # ğŸ—ï¸ ConfiguraciÃ³n e infraestructura
â”‚   â”œâ”€â”€ config/                 # ConfiguraciÃ³n de Supabase, Vite, etc.
â”‚   â”œâ”€â”€ router/                 # React Router setup y rutas protegidas
â”‚   â””â”€â”€ providers/              # App-level providers (AuthProvider, ErrorBoundary)
â”œâ”€â”€ styles/                     # ğŸ¨ Estilos y diseÃ±o
â”‚   â”œâ”€â”€ globals.css             # Reset, variables CSS, estilos base
â”‚   â”œâ”€â”€ themes.css              # Variables para theme claro/oscuro (si existe)
â”‚   â””â”€â”€ layouts.css             # Layouts responsive (topbar, sidebar, grid)
â””â”€â”€ app/                        # ğŸ“± Entry point y configuraciÃ³n
    â”œâ”€â”€ App.tsx                 # App principal (despuÃ©s del refactor)
    â”œâ”€â”€ main.tsx                # Entry point
    â””â”€â”€ index.css               # Imports de estilos globales

**VEREDICTO FINAL**: 
- âŒ **MENTIRA**: Los nÃºmeros de LOC en el PLANREFACTOR estÃ¡n INCORRECTOS
- âœ… **REALIDAD**: Hay problemas arquitectÃ³nicos reales pero NO de la magnitud declarada
- âš ï¸ **ACCIÃ“N REQUERIDA**: Refactor parcial, NO migraciÃ³n masiva

---

## ğŸ¯ VERIFICACIÃ“N DE AFIRMACIONES DEL PLANREFACTOR

### 1. **HOOKS ESPECIALIZADOS (575 LOC)** - âŒ DATOS INCORRECTOS

**AFIRMACIÃ“N DEL PLAN**: "Hooks Especializados (575 LOC)"

**REALIDAD ENCONTRADA**:
```
ğŸ” HOOKS EN /src/hooks/ (GLOBALES):
â”œâ”€â”€ useLazyImage.js        # 98 LOC (NO 124 como afirmado)
â”œâ”€â”€ usePrefetch.js         # 155 LOC (NO 177 como afirmado)  
â”œâ”€â”€ useBanStatus.js        # 67 LOC
â”œâ”€â”€ useResponsiveThumbnail.js  # 133 LOC
â”œâ”€â”€ useThumbnailQueries.js # 109 LOC
â””â”€â”€ TOTAL GLOBAL: 562 LOC â‰ˆ 575 LOC âœ… (CORRECTO)

ğŸ” HOOKS EN /src/features/**/hooks/ (ESPECÃFICOS):
â””â”€â”€ TOTAL FEATURES: 8,604 LOC âŒ (OMITIDO COMPLETAMENTE)

ğŸ” HOOKS EN /src/shared/hooks/ (COMPARTIDOS):
â””â”€â”€ useAppInitialization.js # 46 LOC âŒ (OMITIDO)

ğŸ“Š TOTAL REAL: 9,212 LOC vs 575 LOC declarados
DISCREPANCIA: +1,541% MÃS cÃ³digo del declarado
```

**CONCLUSIÃ“N**: El anÃ¡lisis del PLANREFACTOR **SUBESTIMA MASIVAMENTE** la cantidad real de hooks.

---

### 2. **STORES ZUSTAND DISTRIBUIDOS** - âœ… PROBLEMA REAL VERIFICADO

**AFIRMACIÃ“N DEL PLAN**: "`ordersStore.js` en supplier, `cartStore.js` en buyer"

**REALIDAD ENCONTRADA**:

#### 2.1 OrdersStore - âœ… PROBLEMA CONFIRMADO
```bash
ğŸ“ UBICACIÃ“N PROBLEMÃTICA:
â””â”€â”€ src/features/supplier/my-orders/ordersStore.js  # 250 LOC
    âŒ DeberÃ­a estar en: src/shared/stores/orders/
```

#### 2.2 CartStore - âš ï¸ PARCIALMENTE SOLUCIONADO
```bash
ğŸ“ SITUACIÃ“N ACTUAL:
â”œâ”€â”€ src/shared/stores/cart/cartStore.js           # 36 LOC âœ… CORRECTO
â”œâ”€â”€ src/features/buyer/hooks/cartStore.js         # 19 LOC âš ï¸ DEPRECATED WRAPPER
â””â”€â”€ TOTAL CARTSTORE MODULAR: 2,354 LOC

ğŸ”„ ESTADO DE MIGRACIÃ“N:
â”œâ”€â”€ âœ… Store principal movido a shared/
â”œâ”€â”€ âš ï¸ Wrapper deprecado en buyer/hooks/ 
â””â”€â”€ ğŸ”„ Pendiente: Eliminar wrapper y actualizar imports
```

---

## ğŸ—ï¸ ANÃLISIS ARQUITECTÃ“NICO DETALLADO

### 3.1 DISTRIBUCIÃ“N REAL DE HOOKS POR CATEGORÃA

```
ğŸ“Š HOOKS POR UBICACIÃ“N Y RESPONSABILIDAD:

ğŸŒ HOOKS GLOBALES (/src/hooks/): 562 LOC
â”œâ”€â”€ useLazyImage.js       # 98 LOC - Lazy loading global
â”œâ”€â”€ usePrefetch.js        # 155 LOC - Prefetching de rutas  
â”œâ”€â”€ useBanStatus.js       # 67 LOC - VerificaciÃ³n de baneos
â”œâ”€â”€ useResponsiveThumbnail.js # 133 LOC - Miniaturas responsive
â””â”€â”€ useThumbnailQueries.js    # 109 LOC - Queries de miniaturas

ğŸª HOOKS DE DOMINIO (/src/features/): 8,604 LOC
â”œâ”€â”€ admin_panel/hooks/    # 280 LOC - LÃ³gica administrativa
â”œâ”€â”€ buyer/hooks/          # 2,359 LOC - Carrito y compras 
â”œâ”€â”€ supplier/hooks/       # 2,027 LOC - Dashboard proveedor
â”œâ”€â”€ marketplace/hooks/    # 1,423 LOC - Marketplace B2B
â”œâ”€â”€ checkout/hooks/       # 460 LOC - Proceso de pago
â”œâ”€â”€ profile/hooks/        # 241 LOC - GestiÃ³n de perfiles
â””â”€â”€ otros features/       # 1,814 LOC - Login, UI, etc.

ğŸ”„ HOOKS COMPARTIDOS (/src/shared/hooks/): 46 LOC
â””â”€â”€ useAppInitialization.js # 46 LOC - InicializaciÃ³n global
```

### 3.2 ANÃLISIS DE DUPLICACIÃ“N Y REDUNDANCIA

#### âŒ HOOKS DUPLICADOS DETECTADOS:
```
1. useLazyImage.js:
   â”œâ”€â”€ /src/hooks/useLazyImage.js                    # 98 LOC âœ… Global
   â””â”€â”€ /features/marketplace/ProductPageView/hooks/  # 104 LOC âŒ Duplicado

2. useProductPriceTiers.js:
   â”œâ”€â”€ /features/marketplace/hooks/                  # 48 LOC
   â””â”€â”€ /features/marketplace/ProductPageView/hooks/  # 66 LOC âŒ Posible duplicado
```

#### âš ï¸ HOOKS MAL UBICADOS:
```
1. CartStore en buyer/hooks/:
   â””â”€â”€ Migrado pero wrapper deprecado pendiente de limpiar

2. Hooks de UI especÃ­ficos en features/ui/hooks/:
   â””â”€â”€ useCountrySelector.js # 88 LOC - Candidato para shared/
```

---

## ğŸ¯ PLAN DE ACCIÃ“N CORREGIDO

### FASE 0: AUDITORÃA PRE-ACTIVACIÃ“N (2-4 horas) âŒ OBLIGATORIO

#### 0.1 InvestigaciÃ³n de Errores del Rollback Anterior
```bash
# ANTES DE CUALQUIER CAMBIO - Identificar exactamente quÃ© fallÃ³:

1. VERIFICAR ESQUEMA DE BASE DE DATOS:
   - Â¿Existe tabla product_quantity_ranges?
   - Â¿Existe tabla price_tiers? 
   - Â¿Las columnas coinciden con las queries de domains/?

2. VERIFICAR DEPENDENCIAS DE IMPORTS:
   - Â¿El path ../../../../services/supabase es correcto desde domains/?
   - Â¿Existen todos los archivos importados?

3. PROBAR domains/useSupplierDashboard EN AISLAMIENTO:
   - Crear componente de prueba que solo use este hook
   - Verificar que no arroja errores en consola
   - Confirmar que los datos se cargan correctamente
```

#### 0.2 ComparaciÃ³n TÃ©cnica Exhaustiva âŒ CRÃTICO
```bash
# Analizar EXACTAMENTE quÃ© cambiÃ³ entre versions:

1. ESTRUCTURA DE DATOS RETORNADA:
   # features/ retorna: {products, sales, productStocks, weeklyRequests, monthlyData, totalSales, loading, error}
   # domains/ retorna: Â¿QUÃ‰ MÃS? Â¿Rompe componentes existentes?

2. QUERIES DE BASE DE DATOS:
   # features/ usa: products, sales, request_products
   # domains/ usa: Â¿QUÃ‰ TABLAS ADICIONALES? Â¿Existen todas?

3. MÃ‰TODOS PÃšBLICOS:
   # features/ NO expone mÃ©todos
   # domains/ expone: loadProducts, applyFilters Â¿Los usan componentes?
```

#### 0.3 Protocolo de Prueba Controlada âš ï¸ REQUERIDO
```bash
# NO ACTIVAR hasta completar estas pruebas:

1. ENTORNO LOCAL:
   - Probar domains/useSupplierDashboard en desarrollo
   - Verificar dashboard sin errores
   - Confirmar carga de productos funciona

2. COMPATIBILIDAD:
   - Verificar que ProviderHome.jsx funciona con la API nueva
   - Confirmar que no se rompen filtros o bÃºsquedas
   - Probar operaciones de productos (editar, eliminar)

3. ROLLBACK PREPARADO:
   - Tener backup exacto del import actual
   - Plan de rollback en <30 segundos si falla
```

### FASE 1: LIMPIEZA INMEDIATA (1-2 horas)

#### 1.1 Eliminar Duplicaciones âŒ CRÃTICO
```bash
# Eliminar hook duplicado
rm src/features/marketplace/ProductPageView/hooks/useLazyImage.js

# Actualizar imports hacia el hook global
# Buscar: from './hooks/useLazyImage'
# Reemplazar: from '../../../../hooks/useLazyImage'
```

#### 1.2 Limpiar Wrappers Deprecados âš ï¸ IMPORTANTE  
```bash
# Eliminar wrapper deprecado del cartStore
rm src/features/buyer/hooks/cartStore.js

# Actualizar todos los imports:
# Buscar: from './hooks/cartStore'  
# Reemplazar: from '../../../shared/stores/cart'
```

### FASE 2: REORGANIZACIÃ“N ESTRATÃ‰GICA (4-6 horas)

#### 2.1 Migrar OrdersStore âœ… NECESARIO
```bash
# Crear estructura en shared
mkdir -p src/shared/stores/orders/

# Mover y refactorizar
mv src/features/supplier/my-orders/ordersStore.js src/shared/stores/orders/
```

#### 2.2 Evaluar Hooks para shared/ âš ï¸ OPCIONAL
```bash
# Candidatos para migraciÃ³n a shared/hooks/:
â”œâ”€â”€ useCountrySelector.js     # UI comÃºn
â”œâ”€â”€ useProductValidation.js   # ValidaciÃ³n comÃºn  
â””â”€â”€ useTermsModal.js         # Modales comunes
```

### FASE 3: OPTIMIZACIÃ“N AVANZADA (6-8 horas) - OPCIONAL

#### 3.1 Consolidar Hooks de Marketplace
```bash
# Evaluar fusiÃ³n de hooks similares:
â”œâ”€â”€ useProductFilters.js + useSupplierProductFilters.js
â”œâ”€â”€ useProducts.js + useSupplierProducts.js  
â””â”€â”€ useProductPriceTiers.js (unificar versiones)
```

---

## ğŸ“ˆ MÃ‰TRICAS DE IMPACTO

### ANTES DE LA CORRECCIÃ“N:
```
âŒ Hooks duplicados: 2 archivos 
âŒ Wrappers deprecados: 1 archivo
âŒ Stores mal ubicados: 1 archivo  
âŒ Imports incorrectos: ~15-20 archivos
```

### DESPUÃ‰S DE FASE 1-2:
```
âœ… EliminaciÃ³n de duplicados: -202 LOC
âœ… Limpieza de wrappers: -19 LOC  
âœ… OrdersStore centralizado: +250 LOC en shared/
âœ… Imports actualizados: ~15-20 archivos
```

### RIESGO DE ROLLBACK ACTUALIZADO:
```
ï¿½ FASE 0 (AuditorÃ­a): RIESGO CRÃTICO - OBLIGATORIO
   - Los domains/ causaron el rollback anterior
   - Errores sin identificar pueden repetirse
   - Requiere investigaciÃ³n exhaustiva pre-activaciÃ³n

ğŸŸ¡ FASE 1 (Limpieza): RIESGO MEDIO-BAJO  
   - Cambios atÃ³micos y verificables
   - Rollback sencillo si falla
   - No tocar domains/ hasta auditorÃ­a completa

ğŸŸ¡ FASE 2 (MigraciÃ³n): RIESGO MEDIO
   - Requiere testing de OrdersStore
   - Cambios en imports mÃºltiples

ğŸ”´ FASE 3 (ConsolidaciÃ³n): RIESGO ALTO
   - Cambios en lÃ³gica de negocio
   - NO RECOMENDADO sin testing extensivo
```

---

## ğŸš¨ RECOMENDACIONES CRÃTICAS

### âœ… HACER INMEDIATAMENTE:
1. **AUDITORÃA COMPLETA de domains/useSupplierDashboard** - CRÃTICO ANTES DE ACTIVAR
2. **Eliminar useLazyImage duplicado** - CRÃTICO (sin dependencias con domains/)  
3. **Limpiar cartStore wrapper** - IMPORTANTE (independiente de domains/)
4. **Migrar ordersStore a shared/** - NECESARIO (independiente de domains/)

### âš ï¸ HACER CON PRECAUCIÃ“N:
1. **Investigar errores exactos del rollback anterior** - Antes de cualquier activaciÃ³n
2. **Probar domains/useSupplierDashboard en aislamiento** - Entorno de desarrollo Ãºnicamente  
3. **Verificar esquema de DB vs queries domains/** - product_quantity_ranges, price_tiers

### âŒ NO HACER (ALTO RIESGO):
1. **Activar domains/useSupplierDashboard sin auditorÃ­a** - CAUSÃ“ EL ROLLBACK ANTERIOR
2. **Eliminar /src/domains/** - Son el objetivo final pero necesitan depuraciÃ³n
3. **MigraciÃ³n masiva sin identificar problemas** - Repetir errores del rollback

---

## ğŸ“‹ CONCLUSIONES FINALES

1. **El PLANREFACTOR SUBESTIMA** la cantidad real de hooks en un 1,541%
2. **Los problemas son REALES** pero NO de la magnitud declarada  
3. **Los archivos domains/ NO SON RESIDUOS** - son el **OBJETIVO FINAL** del refactor 3.3
4. **âš ï¸ CRITICAL: domains/useSupplierDashboard CAUSÃ“ EL ROLLBACK** - requiere auditorÃ­a exhaustiva
5. **useSupplierDashboard en domains/ es SUPERIOR** (+138 LOC) pero **TIENE ERRORES NO IDENTIFICADOS**
6. **Servicios admin en domains/ estÃ¡n CORRECTAMENTE MIGRADOS** pero **NO PROBADOS**
7. **Se requiere INVESTIGACIÃ“N DE ERRORES**, NO activaciÃ³n ciega

### ğŸš¨ **ADVERTENCIAS CRÃTICAS:**
- **NO ACTIVAR domains/ sin auditorÃ­a completa** - Ya causÃ³ un rollback de 15 horas
- **Los domains/ pueden tener dependencias rotas** - Verificar esquema DB y imports  
- **La "mejora" puede ser incompatible** - Verificar API y estructura de datos
- **Error desconocido sin identificar** - Puede repetirse si no se investiga

**PRÃ“XIMO PASO RECOMENDADO**: **AUDITORÃA TÃ‰CNICA EXHAUSTIVA** de domains/useSupplierDashboard (2-4 horas) para identificar exactamente quÃ© errores causaron el rollback antes de considerar cualquier activaciÃ³n.
